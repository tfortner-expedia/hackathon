<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stacks | Cards Against Hotels</title>
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/card-front.css" />
    <link rel="stylesheet" href="css/rotate.css" />
    <script src="js/vendor/modernizr.js"></script>
    <script>
        var loadingImage = document.createElement('img');
        loadingImage.src = "img/loading color.gif";
    
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min)) + min;
        }
        
        function loadImageAttachCss(imageUrl, hotelName, starRating, formattedPrice, zOffset) {
            // start preloading
            var image = document.createElement('img');
            
            // transform math
            var xTransform = getRandomInt(-50, 50);
            var yTransform = getRandomInt(-50, 50);
            var rotate = 0;
            if (zOffset == 0) {
                rotate = getRandomInt(-2, 2);
            } else {
                rotate = getRandomInt(-10, 10);
            }

            var card = document.createElement("div");
            card.className = "row card";
            card.style.transform = "translate(" + xTransform + "px, " + yTransform + "px) rotate(" + rotate + "deg)";
            card.style.webkitTransform = "translate(" + xTransform + "px, " + yTransform + "px) rotate(" + rotate + "deg)";
            card.style.zIndex = 50 - zOffset;
            
            var cardFlipper = document.createElement("div");
            cardFlipper.className = "flipper";
            card.appendChild(cardFlipper);

            cardFlipper.appendChild(makeCardFront(image, hotelName, starRating, formattedPrice, card)); 
            var cardBack = makeCardBack();
            cardFlipper.appendChild(cardBack);

            image.onclick = function() {
                card.className = card.className + " swiped";
            };

            image.onload = function() {
                cardBack.style.height = image.height + "px";
                cardBack.style.width = image.width + "px";
                window.setTimeout(function() {document.getElementById("cards").appendChild(card);}, getRandomInt(0, 600));  
            };
            image.src = imageUrl;
            
            return card;
        }
        
        function makeCardBack() {
            var cardBack = document.createElement("div");
            cardBack.className = "cardBack";
            cardBack.style.backgroundColor = "white";
            cardBack.innerHTML = "This is the super cool back of card.";
            
            return cardBack;
        }
        
        function makeCardFront(image, hotelName, starRating, formattedPrice, card) {
            var cardFront = document.createElement("div");
            cardFront.className = "cardFront";

            var infoButton = document.createElement("div");
            infoButton.className = "large-12 columns";
            infoButton.innerHTML = '<div class="fi-background"><i class="fi-info"></i></div>';
            infoButton.onclick = function () {
                card.className = card.className + " flipped";
            }
            cardFront.appendChild(infoButton);
            
            // wrap the card for protection from the image.
            var outerCardCasing = document.createElement("div");
            outerCardCasing.className = "large-12 columns";
            cardFront.appendChild(outerCardCasing);
            
            outerCardCasing.appendChild(image);

            var hotelHighlights = document.createElement("div");
            hotelHighlights.className = "row hotel-highlights";
            outerCardCasing.appendChild(hotelHighlights);
            
            var hotelNameHolder = document.createElement("div");
            hotelNameHolder.className = "small-9 columns";
            hotelHighlights.appendChild(hotelNameHolder);
            
            var hotelNameBlock = document.createElement("h4");
            var stars = document.createElement("span");
            for (var i = 0; i < starRating; i++) {
                var star = document.createElement("i");
                star.className = "fi-star";
                stars.appendChild(star);
            }
            
            hotelNameBlock.innerHTML = hotelName + " ";
            hotelNameBlock.appendChild(stars);
            hotelNameHolder.appendChild(hotelNameBlock);       

            var hotelPriceHolder = document.createElement("div");
            hotelPriceHolder.className = "small-3 columns";
            hotelPriceHolder.innerHTML = '<i class="fi-burst-sale"></i> <span>' + formattedPrice + '</span>'
            hotelHighlights.appendChild(hotelPriceHolder);

            return cardFront;
        }
    </script>
  </head>
  <body>    
      <h1>Cards Against Hotels</h1>
      <div id="cards">
      </div>
      <script>
          var hotels = [
              {
                  "name": "St. Pancras Renaissance London Hotel",
                  "starRating": 5,
                  "imageUrl": "http://images.travelnow.com/hotels/4000000/3910000/3907800/3907784/3907784_147_z.jpg",
                  "price": "$286"
              },
              {
                  "name": "Le Meridien Piccadilly",
                  "starRating": 5,
                  "imageUrl": "http://images.travelnow.com/hotels/1000000/30000/21600/21538/21538_134_z.jpg",
                  "price": "$300"
              },
              {
                  "name": "Ventures Hotel",
                  "starRating": 2,
                  "imageUrl": "http://images.travelnow.com/hotels/1000000/910000/901000/900935/900935_30_z.jpg",
                  "price": "$123"
              },
              {
                  "name": "Draycott Hotel",
                  "starRating": 2,
                  "imageUrl": "http://images.travelnow.com/hotels/1000000/470000/462400/462335/462335_49_z.jpg",
                  "price": "$251"
              },
              {
                  "name": "Park Plaza Westminster Bridge London",
                  "starRating": 4,
                  "imageUrl": "http://images.travelnow.com/hotels/4000000/3120000/3113100/3113039/3113039_31_z.jpg",
                  "price": "$200"
              }
          ]
      
          for (var i = 0; i < hotels.length; i++) {
              loadImageAttachCss(hotels[i].imageUrl, hotels[i].name, hotels[i].starRating, hotels[i].price, i);    
          }
          
      </script>
  </body>
</html>
